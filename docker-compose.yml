services:

  channels:
    build: ./video-stream-channels
    container_name: channels
    ports:
      - "2276:2276"

  viewers:
    build: ./video-stream-viewers
    container_name: viewers
    ports:
      - "2277:2277"
    depends_on:
      - channels

  rtmp:
    build: ./video-stream-rtmp
    container_name: rtmp
    ports:
      - "1935:1935"
      - "8080:8080"
    depends_on:
      - viewers
    volumes:
      - ./hls:/var/www/hls

  irc:
    image: ghcr.io/ergochat/ergo:stable
    container_name: irc
    command: ["--conf", "/ircd/ergo.yaml"]
    ports:
      - "6667:6667"   # plaintext IRC
      - "6697:6697"   # TLS IRC
    volumes:
      - ./video-stream-irc/ergo:/ircd
      - ./video-stream-irc/tls:/ircd/tls:ro
    restart: unless-stopped

  ui:
    build: ./video-stream-ui
    container_name: ui
    depends_on:
      - rtmp
    ports:
    - "3000:3000"